---
// MobileMenu.astro - Mobile navigation drawer with glassmorphism
---

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu-overlay"
  class="fixed inset-0 bg-neutral-900/60 backdrop-blur-md z-40 opacity-0 pointer-events-none transition-opacity duration-300"
  aria-hidden="true"
>
</div>

<!-- Mobile Menu Drawer -->
<nav
  id="mobile-menu-drawer"
  class="fixed top-0 right-0 bottom-0 w-full max-w-sm z-50 transform translate-x-full transition-transform duration-300 ease-out"
  role="dialog"
  aria-modal="true"
  aria-label="Menu de navegação mobile"
>
  <!-- Glassmorphism Container -->
  <div class="h-full glass-mobile-menu flex flex-col">

    <!-- Header with Logo and Close Button -->
    <div class="flex items-center justify-between p-6 border-b border-white/20">
      <div class="flex items-center gap-3">
        <img
          src="/images/logo-128.webp"
          alt="Viajadoras"
          width="32"
          height="32"
          class="h-8 w-8"
        />
        <h2 class="text-neutral-900 text-xl font-bold">Viajadoras</h2>
      </div>
      <button
        id="mobile-menu-close"
        class="text-neutral-900 hover:text-primary transition-colors p-2 -mr-2"
        aria-label="Fechar menu"
      >
        <span class="material-symbols-outlined text-3xl">close</span>
      </button>
    </div>

    <!-- Navigation Links -->
    <div class="flex-1 overflow-y-auto py-8 px-6">
      <ul class="space-y-2">
        <li>
          <a
            href="#como-funciona"
            class="mobile-menu-link block py-4 px-4 text-lg font-medium text-neutral-700 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            <span class="flex items-center gap-3">
              <span class="material-symbols-outlined text-2xl">info</span>
              Como Funciona
            </span>
          </a>
        </li>
        <li>
          <a
            href="#para-quem"
            class="mobile-menu-link block py-4 px-4 text-lg font-medium text-neutral-700 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            <span class="flex items-center gap-3">
              <span class="material-symbols-outlined text-2xl">groups</span>
              Para Quem
            </span>
          </a>
        </li>
        <li>
          <a
            href="#destinos"
            class="mobile-menu-link block py-4 px-4 text-lg font-medium text-neutral-700 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            <span class="flex items-center gap-3">
              <span class="material-symbols-outlined text-2xl">flight_takeoff</span>
              Destinos
            </span>
          </a>
        </li>
        <li>
          <a
            href="#faq"
            class="mobile-menu-link block py-4 px-4 text-lg font-medium text-neutral-700 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            <span class="flex items-center gap-3">
              <span class="material-symbols-outlined text-2xl">help</span>
              FAQ
            </span>
          </a>
        </li>
      </ul>

      <!-- Divider -->
      <div class="my-8 border-t border-white/20"></div>

      <!-- Additional Links -->
      <ul class="space-y-2">
        <li>
          <a
            href="/termos"
            class="mobile-menu-link block py-3 px-4 text-base font-normal text-neutral-600 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            Termos de Uso
          </a>
        </li>
        <li>
          <a
            href="/privacidade"
            class="mobile-menu-link block py-3 px-4 text-base font-normal text-neutral-600 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            Privacidade
          </a>
        </li>
        <li>
          <a
            href="https://instagram.com/viajadorasbr"
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-menu-link block py-3 px-4 text-base font-normal text-neutral-600 hover:text-primary hover:bg-primary/5 rounded-xl transition-all duration-200"
          >
            <span class="flex items-center gap-3">
              <span class="material-symbols-outlined text-xl">link</span>
              Instagram
            </span>
          </a>
        </li>
      </ul>
    </div>

    <!-- CTA Button at Bottom -->
    <div class="p-6 border-t border-white/20">
      <a
        href="#lead-form"
        class="mobile-menu-cta block w-full text-center px-6 py-4 bg-gradient-to-r from-primary to-primary-600 text-white text-lg font-semibold rounded-xl shadow-primary hover:shadow-primary-lg hover:scale-[1.02] active:scale-[0.98] transition-all duration-200"
      >
        <span class="flex items-center justify-center gap-2">
          <span class="material-symbols-outlined">person_add</span>
          Junte-se à Viajadoras
        </span>
      </a>
    </div>
  </div>
</nav>

<style>
  /* Glassmorphism styling */
  .glass-mobile-menu {
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(253, 248, 245, 0.95) 50%,
      rgba(255, 245, 240, 0.95) 100%
    );
    border-left: 1px solid rgba(255, 127, 80, 0.2);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    box-shadow: -10px 0 40px rgba(255, 127, 80, 0.1);
  }

  /* Smooth transitions for menu items */
  .mobile-menu-link {
    position: relative;
    overflow: hidden;
  }

  .mobile-menu-link::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    width: 3px;
    height: 0;
    background: linear-gradient(to bottom, #FF7F50, #FF6B40);
    transform: translateY(-50%);
    transition: height 0.3s ease;
    border-radius: 0 2px 2px 0;
  }

  .mobile-menu-link:hover::before {
    height: 60%;
  }

  /* CTA Button gradient animation */
  .mobile-menu-cta {
    position: relative;
    overflow: hidden;
  }

  .mobile-menu-cta::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      transparent
    );
    transition: left 0.5s ease;
  }

  .mobile-menu-cta:hover::before {
    left: 100%;
  }

  /* Scrollbar styling */
  #mobile-menu-drawer ::-webkit-scrollbar {
    width: 6px;
  }

  #mobile-menu-drawer ::-webkit-scrollbar-track {
    background: rgba(255, 127, 80, 0.05);
    border-radius: 3px;
  }

  #mobile-menu-drawer ::-webkit-scrollbar-thumb {
    background: rgba(255, 127, 80, 0.3);
    border-radius: 3px;
  }

  #mobile-menu-drawer ::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 127, 80, 0.5);
  }
</style>

<script>
  // Mobile Menu Controller
  class MobileMenu {
    private overlay: HTMLElement | null;
    private drawer: HTMLElement | null;
    private openButton: HTMLElement | null;
    private closeButton: HTMLElement | null;
    private menuLinks: NodeListOf<HTMLElement> | null;
    private isOpen: boolean = false;
    private originalBodyOverflow: string = '';
    private originalBodyPaddingRight: string = '';

    constructor() {
      this.overlay = document.getElementById('mobile-menu-overlay');
      this.drawer = document.getElementById('mobile-menu-drawer');
      this.openButton = document.getElementById('mobile-menu-button');
      this.closeButton = document.getElementById('mobile-menu-close');
      this.menuLinks = document.querySelectorAll('.mobile-menu-link');

      this.init();
    }

    private init(): void {
      // Open button click
      this.openButton?.addEventListener('click', () => this.open());

      // Close button click
      this.closeButton?.addEventListener('click', () => this.close());

      // Overlay click (click outside)
      this.overlay?.addEventListener('click', () => this.close());

      // ESC key press
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.isOpen) {
          this.close();
        }
      });

      // Close on navigation link click
      this.menuLinks?.forEach(link => {
        link.addEventListener('click', () => {
          // Small delay to allow smooth navigation
          setTimeout(() => this.close(), 150);
        });
      });

      // Handle window resize - close menu if opened on mobile but resized to desktop
      let resizeTimer: ReturnType<typeof setTimeout>;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          if (this.isOpen && window.innerWidth >= 768) {
            this.close();
          }
        }, 250);
      });
    }

    private open(): void {
      if (this.isOpen) return;

      this.isOpen = true;

      // Prevent body scroll and handle scrollbar
      this.preventBodyScroll();

      // Show overlay
      if (this.overlay) {
        this.overlay.classList.remove('pointer-events-none', 'opacity-0');
        this.overlay.classList.add('pointer-events-auto', 'opacity-100');
        this.overlay.setAttribute('aria-hidden', 'false');
      }

      // Show drawer
      if (this.drawer) {
        this.drawer.classList.remove('translate-x-full');
        this.drawer.classList.add('translate-x-0');
      }

      // Focus management - focus close button when menu opens
      setTimeout(() => {
        this.closeButton?.focus();
      }, 100);

      // Announce to screen readers
      this.announceToScreenReader('Menu aberto');
    }

    private close(): void {
      if (!this.isOpen) return;

      this.isOpen = false;

      // Restore body scroll
      this.restoreBodyScroll();

      // Hide overlay
      if (this.overlay) {
        this.overlay.classList.remove('pointer-events-auto', 'opacity-100');
        this.overlay.classList.add('pointer-events-none', 'opacity-0');
        this.overlay.setAttribute('aria-hidden', 'true');
      }

      // Hide drawer
      if (this.drawer) {
        this.drawer.classList.remove('translate-x-0');
        this.drawer.classList.add('translate-x-full');
      }

      // Return focus to open button
      setTimeout(() => {
        this.openButton?.focus();
      }, 100);

      // Announce to screen readers
      this.announceToScreenReader('Menu fechado');
    }

    private preventBodyScroll(): void {
      // Store original values
      this.originalBodyOverflow = document.body.style.overflow;
      this.originalBodyPaddingRight = document.body.style.paddingRight;

      // Calculate scrollbar width
      const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;

      // Prevent scroll and compensate for scrollbar
      document.body.style.overflow = 'hidden';
      if (scrollbarWidth > 0) {
        document.body.style.paddingRight = `${scrollbarWidth}px`;
      }
    }

    private restoreBodyScroll(): void {
      // Restore original values
      document.body.style.overflow = this.originalBodyOverflow;
      document.body.style.paddingRight = this.originalBodyPaddingRight;
    }

    private announceToScreenReader(message: string): void {
      // Create temporary element for screen reader announcement
      const announcement = document.createElement('div');
      announcement.setAttribute('role', 'status');
      announcement.setAttribute('aria-live', 'polite');
      announcement.className = 'sr-only';
      announcement.textContent = message;

      document.body.appendChild(announcement);

      // Remove after announcement
      setTimeout(() => {
        document.body.removeChild(announcement);
      }, 1000);
    }
  }

  // Initialize mobile menu when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      new MobileMenu();
    });
  } else {
    new MobileMenu();
  }
</script>
